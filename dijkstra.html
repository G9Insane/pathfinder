<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>dijkstra v1</title>
</head>
<body>
    <div id="placeholder"></div>
    <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script>
  
    $.getJSON('data/GrecoRoman.json', function(graph) {
        
        // FUNCTION TO CLEAN UP DATA AND DELETE "stuff"
        $.each(graph.edges, function(index, edge){
            if(edge.endNode == "undefined_undefined"){

                delete graph.edges[index];
            }
        });

        // $.each is a jquery function that iterates over any collection (of objects or arrays)
        // "index" is the name of the object
        // "edge" is a var

        $.each(graph.edges, function(index, edge){
        
                var startNodeName = edge.startNode;
                var endNodeName = edge.endNode;
                
                var startNode = graph.nodes[startNodeName];
                var endNode = graph.nodes[endNodeName];

                // function to calculate edge length
                var findEdgeLength = function(x0, y0, x1, y1){
                    return Math.sqrt((x0 -= x1) * x0 + (y0 -= y1) * y0);
                };
                
                // START NODE -- EDGES
                if (!startNode.outEdges) {
                    startNode.outEdges = {};
                }
                startNode.outEdges[index] = index;
                
            

                // END NODE -- EDGES
                
                    if (!endNode.outEdges) {
                        endNode.outEdges = {};
                    }
                    endNode.outEdges[index] = index;

                // calculate edge length
                edge.edgeLength = findEdgeLength(startNode.x, startNode.y, endNode.x, endNode.y);     
           
        });   
  
        // Assign  initial weight  (0 - Infinity) and visited (true/false) value to nodes
        $.each(graph.nodes, function(index, node){

            startPoint = "365_550";
            endPoint = "30_551";

            if (index == startPoint) {
                node.weight = 0;
            } else {
                node.weight = Infinity;
            }
            curNode = startPoint;
            node.visited = false; 
        });
        var path = [];
        function dijkstra() {
            
            // find node with the smallest weight
            var minWeight = Infinity;
            $.each(graph.nodes, function(index, node){ 
                if(node.visited == false) {
                    if (minWeight > node.weight) {
                            minWeight = node.weight;
                            minWeightNode = index;
                    }       
                }
            });
            
            // assign the smallest weight node name to curNode
            curNode = minWeightNode;
            path.push(curNode);
            
            //console.log(curNode);
            // add curNode to visited
            graph.nodes[curNode].visited = true;
            
            // cycle through the edges attached to the min node
            $.each(graph.nodes[curNode].outEdges, function(edge) {

                    // evalNode: the node that's on the other end of the edge -- its value will be evaluated and potentially changed  
        

                    if (graph.edges[edge].startNode.visited == false) {
                        evalNode = graph.edges[edge].startNode;
                    } else {
                        
                        evalNode = graph.edges[edge].endNode;
                        
                    }

                   //console.log(graph.nodes[evalNode].weight);
                    // edge length + current node weight
                    var proposedWeight = graph.nodes[curNode].weight + graph.edges[edge].edgeLength; 

                    // if the evalNode has not been visited and has a higher weight than proposed weight, its weight will be changed to the proposed weight
                    
                        if (graph.nodes[evalNode].weight > proposedWeight) {
                            graph.nodes[evalNode].weight = proposedWeight;
                        }
                    
               //console.log("still thinking...");

            });
        }

    while(curNode != endPoint) {
        dijkstra();
    }  
console.log(path);
    $.each(graph.nodes, function(index, node){

            console.log(index + ":     " + node.weight);
        });
    //console.log("done!")
    //console.log(curNode);
       
  });
    </script>
</body>
</html>